<?php
global $Linea1, $Linea2, $Linea3, $Titulo;

$Linea1 =  $this->modelo_valores->GetTexto('LINEA1');		 
$Linea2 =  $this->modelo_valores->GetTexto('LINEA2');
$Linea3 =  $this->modelo_valores->GetTexto('LINEA3');
$Titulo = "Boletin de calificaciones";

$this->fpdf->SetAutoPageBreak(TRUE, 20);
$this->fpdf->Open();
$this->fpdf->setMargins(20, 10, 15);
$this->fpdf->SetTextColor(0,0,0);
$this->fpdf->AliasNbPages();
$this->fpdf->AddPage('P', 'Letter');


$this->fpdf->setFont('Arial', '', 12);

$this->fpdf->Cell(50,5, 'Nombre del estudiante:', 0, 0, 'L');  $this->fpdf->Cell(0,5, utf8_decode($NombreEstudiante), 0, 1, 'L');
$this->fpdf->Cell(20,5, 'Curso:', 0, 0, 'L');    $this->fpdf->Cell(40,5, utf8_decode($NombreCurso), 0, 1, 'L');

//cabezera de fila
$this->fpdf->setFont('times', 'B', 10);

$this->fpdf->setFillColor(220, 220, 220);
$this->fpdf->Cell(17, 5, '', 0, 0, 'C',0);
$this->fpdf->Cell(70, 5, 'ASIGNATURA', 1, 0, 'C',1);

$this->fpdf->Cell(25, 5, '1r.semestre', 1, 0, 'C',1);
$this->fpdf->Cell(25, 5, '2o.semestre', 1, 0, 'C',1);
$this->fpdf->Cell(25, 5, 'Prom.final', 1, 1, 'C',1);

//calculos
$query = $this->modelo_estudiante->TablaMateriasCurso($CodEstudiante, 1);  //primer semestre
//para cada materia, obtenemos su promedio de 1r.sem
$Cods = array(); 
$S1 = array(); $S2 = array();
foreach($query->result() as $row) {
	$r = 0; $c = 0;
	for($i=1; $i<=12; $i++) {
		eval('$aux = $row->n'.$i.';');
		$r += $aux; 
		$c += ($aux!=0? 1: 0);
	}
	$Cods[$row->CodMateria2] = $row->CodMateria2;
	$S1[$row->CodMateria2] = ($c!=0? $r/$c: 0);
	$S2[$row->CodMateria2] = 0;
}

$query = $this->modelo_estudiante->TablaMateriasCurso($CodEstudiante, 2);  //segundo semestre
//para cada materia, obtenemos su promedio de 2o.sem
foreach($query->result() as $row) {
	$r = 0; $c = 0;
	for($i=1; $i<=12; $i++) {
		eval('$aux = $row->n'.$i.';');
		$r += $aux; 
		$c += ($aux!=0? 1: 0);
	}
	$S2[$row->CodMateria2] = ($c!=0? $r/$c: 0);
}

//cuerpo del reporte
$this->fpdf->setFont('times', '', 10);
$cont=0;

if(isset($S1) || isset($S2)) {
	foreach($Cods as $c) {
		$this->fpdf->Cell(17, 5, '', 0, 0, 'C',0);
		$this->fpdf->Cell(70, 5, $this->modelo_estudiante->NombreMateria($c), 1, 0, 'C',1);
		$this->fpdf->Cell(25, 5, sprintf('%.1f', $S1[$c]), 1, 0, 'C',1);
		$this->fpdf->Cell(25, 5, sprintf('%.1f', $S2[$c]), 1, 0, 'C',1);
		$this->fpdf->Cell(25, 5, sprintf('%.1f', promedio2($S1[$c],$S2[$c])), 1, 1, 'C',1);
	}
}

$this->fpdf->Output('reporte.pdf','D');