<?php
class Cambia_clave_alumno extends CI_Controller {
	
	function __construct() {
		parent::__construct();
                
        $this->load->library(array('encrypt', 'form_validation'));		
		$this->load->helper(array('form', 'url', 'utiles'));
		$this->load->model('modelo_docente', '', TRUE);	
	}
	
	function index() {
		$CodEstudiante = $this->session->userdata('CodEstudiante');

        $this->form_validation->set_rules('ClaveActual', '"contrase&ntilde;a actual"', 'required|min_length[5]|max_length[12]|xss_clean');
		$this->form_validation->set_rules('NuevaClave1', '"nueva contrase&ntilde;a"', 'required|min_length[5]|max_length[12]|xss_clean');
		$this->form_validation->set_rules('NuevaClave2', '"confirmaci&oacute;n de contrase&ntilde;a"', 'required|matches[NuevaClave1]|xss_clean');
		$this->form_validation->set_error_delimiters('<p class="error">','</p>');
		
        $data['VistaMenu'] = 'vista_menu_estudiante';
		if( $this->form_validation->run() ) {
            $this->load->model('modelo_usuario', '', TRUE);	
			$this->modelo_usuario->CambiaClave( $this->session->userdata('CodUsuario'), $this->input->post('NuevaClave1'));
            $data['Mensaje'] = 'La contrase&ntilde;a ha sido cambiada correctamente.';
			$data['VistaMenu'] = 'vista_menu_estudiante';
            //$data['VistaPrincipal'] = 'vista_cambia_clave_alumno';
        }
        else  {
            $data['VistaPrincipal'] = 'vista_cambia_clave_alumno';
        }
        $this->load->view('vista_maestra_alumno', $data);
	}
}
?>